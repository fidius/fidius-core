#!/usr/bin/ruby

require 'yaml'
require 'drb'
begin
  cfg = YAML.load_file(File.expand_path '../../config/msf.yml', __FILE__)
rescue
  puts "No DRb config `config/msf.yml' found."
  raise
end

$:.unshift(File.join cfg[:msf_path], 'lib')
require 'msf/base'


class MsfDRbD
  def initialize
    @uri = "druby://#{cfg[:drb_host]}:#{cfg[:drb_port]}"
    puts 'Loading Metasploit framework'
    @framework = Msf::Simple::Framework.create
    DRb.start_service uri, self
    puts 'Loaded. Waiting...'
    DRb.thread.join
  end
  
  def framework
    @framework
  end
  
  def debug
    p @framework.sessions
  end
end
