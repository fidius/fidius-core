module FIDIUS
  module Action
    module PostExploit
      class DetectWebserver
        include FIDIUS::Action::PostExploit::PostExploit

        def get_loudness_host
          10
        end

        def get_loudness_net
          0
        end

        def autorun
          true
        end

        def id
          "detectWebserver"
        end

        def run session, host
          webserver = identify_webserver session
          if webserver
            host.webserver = webserver
            host.save
          end
        end

        def identify_webserver session
          processes = session.sys.process.get_processes
          service_kind = nil
          path_to_service_config = nil
          processes.each do |pro|
            tmp_pro = pro['name']
            return "IIS" if tmp_pro.include?("inetinfo.exe")
            return "APACHE" if tmp_pro.include?("apache2")
            return "NGINX" if tmp_pro.include?("nginx")
          end
          return nil
        end

      end #class DetectWebserver
    end #module PostExploit
  end #module Action
end #module FIDIUS
