module FIDIUS
  module Action
    module PostExploit
      class GatherSysinfo
        include FIDIUS::Action::PostExploit::PostExploit

        def get_loudness_host
          10
        end

        def get_loudness_net
          0
        end

        def autorun
          true
        end

        def id
          "gatherSysinfo"
        end

        def run session, host, *args
          return unless host
          sysinfo = session.sys.config.sysinfo
          host.name = sysinfo["Computer"]
          host.arch = sysinfo["Architecture"]
          case sysinfo["OS"]
          when /Windows/
            host.os_name = "Windows"
            case sysinfo["OS"]
            when /Service Pack 1/
              host.os_sp = "SP1"
            when /Service Pack 2/
              host.os_sp = "SP2"
            when /Service Pack 3/
              host.os_sp = "SP3"
            when /Service Pack 4/
              host.os_sp = "SP4"
            end
          when /Linux/
            host.os_name = "Linux"
          else
            host.os_name = sysinfo["OS"]
          end
          host.os_info = sysinfo["OS"]
          host.lang = sysinfo["System Language"]
          host.save
        end

      end #class GatherSysinfo
    end #module PostExploit
  end #module Action
end #module FIDIUS
